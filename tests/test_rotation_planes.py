#!/usr/bin/env python

import unittest
from post_refinement_analysis.modules.rotation_planes import Rotation


class testRotation(unittest.TestCase):
    def setUp(self):
        """
        Defines sample lst file for analysis
        """

        self.test = Rotation(test_mode=True)

        self.sample_lst_file = [
            "\n",
            " +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n",
            " +  SHELXL -  CRYSTAL STRUCTURE REFINEMENT  -   MULTI-CPU VERSION  +\n",
            " +  Copyright(C) George M. Sheldrick 1993-2018     Version 2018/3  +\n",
            " +  200                        started at 10:59:49 on 03-Aug-2022  +\n",
            " +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n",
            "\n",
            " Command line parameters: 200 -a50000 -b3000 -c624 -g0 -m0 -t12\n",
            "\n",
            " -a sets the approximate maximum number of atoms including hydrogens.\n",
            " -b sets the maximum number of full-matrix parameters (not used by CGLS).\n",
            " For example -b9000 allows refinement of 1000 anisotropic atoms or 3000\n",
            " with BLOC 1. For a 32-bit version, -b times the square root of the\n",
            " number of threads should not exceed about 65500. -c sets the reflection\n",
            " buffer size. This depends on the CPU cache size but will rarely\n",
            " need changing.\n",
            "\n",
            " -g sets the number of reflection groups used for calculating R_complete,\n",
            " This must be greater than 1 but not greater than the total number of\n",
            " reflections for refinement. -m sets the current reflection group number.\n",
            " This may not be less than 1 nor greater than the number set by -g. These\n",
            " command line flags override other ways of defining free-R reflections.\n",
            " The -m value is also used as a seed for the WIGL pseudo-random shifts.\n",
            "\n",
            " -t sets the number of threads, otherwise it is set to the apparent\n",
            " number of CPUs. For optimal performance on hyperthreading systems,\n",
            " -t should be set to a little more than half the number of CPUs;\n",
            " e.g. -t4 or -t5 for an Intel i7 processor.\n",
            "\n",
            " Running 12 threads on 12 processors\n",
            "\n",
            " TITL jkc18jc03bVT_11_200_00 in P2(1)/n\n",
            "     200.res\n",
            "     created by SHELXL-2018/3 at 10:11:30 on 03-Aug-2022\n",
            " REM P2(1)/n (#14 in standard setting)\n",
            " CELL 0.71073  10.272757   4.673770  11.309690  90.0000  92.1849  90.0000\n",
            " ZERR    2.00   0.000643   0.000360   0.000816   0.0000   0.0068   0.0000\n",
            " LATT  1\n",
            " SYMM 1/2-X, 1/2+Y, 1/2-Z\n",
            " SFAC C H O CU\n",
            " UNIT 20 28 8 2\n",
            "\n",
            " V =      542.61     F(000) =     270.0     Mu =   2.00 mm-1      Cell Wt =      523.50    Rho =  1.602\n",
            "\n",
            " L.S. 10\n",
            " BOND\n",
            " LIST 4\n",
            " CONF\n",
            " ACTA\n",
            " MPLA Cu1 O1 O2 C2 C3 C4\n",
            " SHEL 10 0.73\n",
            " FMAP 2\n",
            " PLAN 20\n",
            " WGHT      0.0354      0.2720\n",
            " FVAR       8.16327\n",
            " CU1   4    0.500000    0.000000    0.500000    10.50000    0.02010    0.01932 =\n",
            "          0.02403   -0.00402    0.00608   -0.00255\n",
            " C1    1    0.817490    0.558901    0.552847    11.00000    0.02154    0.03047 =\n",
            "          0.03396   -0.00356    0.00322   -0.00483\n",
            " AFIX 137\n",
            " H1A   2    0.876964    0.422514    0.521524    11.00000   -1.50000\n",
            " H1B   2    0.852779    0.632313    0.626587    11.00000   -1.50000\n",
            " H1C   2    0.804668    0.713432    0.497708    11.00000   -1.50000\n",
            " AFIX   0\n",
            " O1    3    0.662055    0.203645    0.506335    11.00000    0.02197    0.02175 =\n",
            "          0.02953   -0.00402    0.00694   -0.00237\n",
            " O2    3    0.434749    0.197702    0.634362    11.00000    0.02457    0.02205 =\n",
            "          0.02654   -0.00314    0.00825   -0.00334\n",
            " C2    1    0.689320    0.415689    0.572747    11.00000    0.01997    0.01902 =\n",
            "          0.02322    0.00298   -0.00100   -0.00015\n",
            " C4    1    0.488366    0.410677    0.685934    11.00000    0.02563    0.01988 =\n",
            "          0.01907    0.00076    0.00098    0.00229\n",
            " C3    1    0.609127    0.525643    0.659431    11.00000    0.02586    0.02437 =\n",
            "          0.02275   -0.00455    0.00112   -0.00468\n",
            " AFIX  43\n",
            " H3    2    0.638249    0.685133    0.701902    11.00000   -1.20000\n",
            " AFIX   0\n",
            " C5    1    0.413385    0.544845    0.783423    11.00000    0.03168    0.03377 =\n",
            "          0.02897   -0.00915    0.00980   -0.00274\n",
            " AFIX 137\n",
            " H5A   2    0.374791    0.720664    0.755651    11.00000   -1.50000\n",
            " H5B   2    0.471402    0.583220    0.850090    11.00000   -1.50000\n",
            " H5C   2    0.346154    0.416198    0.806688    11.00000   -1.50000\n",
            " AFIX   0\n",
            " HKLF 4\n",
            "\n",
            "\n",
            "\n",
            " Covalent radii and connectivity table for  jkc18jc03bVT_11_200_00 in P2(1)/n                                          \n",
            " C      0.770\n",
            " H      0.320\n",
            " O      0.660\n",
            " CU     1.280\n",
            "\n",
            " Cu1 - O1 O1_$1 O2 O2_$1\n",
            " C1 - C2\n",
            " O1 - C2 Cu1\n",
            " O2 - C4 Cu1\n",
            " C2 - O1 C3 C1\n",
            " C4 - O2 C3 C5\n",
            " C3 - C4 C2\n",
            " C5 - C4\n",
            "\n",
            "\n",
            " Operators for generating equivalent atoms:\n",
            " $1   -x+1, -y, -z+1\n",
            "\n",
            "\n",
            "   h   k   l        Fo^2      Sigma    Why rejected (first 50 of each listed)\n",
            "   2   0   1      193.09     64.35     systematically absent but >3sig(I)\n",
            "\n",
            "       58  Reflections outside SHEL resolution limits rejected\n",
            "      225  Systematically absent reflections rejected\n",
            "\n",
            "\n",
            "     2892  Reflections read, of which     283  rejected\n",
            "\n",
            " -13 =< h =< 11,     -6 =< k =<  6,    -14 =< l =< 15,   Max. 2-theta =   58.24\n",
            "\n",
            "        1  Systematic absence violations (I>3sig(I)) before merging\n",
            "\n",
            "        2  Inconsistent equivalents\n",
            "\n",
            "     1401  Unique reflections, of which       0  suppressed\n",
            "\n",
            " R(int) = 0.0188     R(sigma) = 0.0341      Friedel opposites merged\n",
            "\n",
            " Maximum memory for data reduction =     1149 /    14084\n",
            "\n",
            "\n",
            " Reflection statistics for all twin components combined (TWST 0 set)\n",
            " Number of data for d > 0.730A (CIF: max) and d > 0.833A (CIF: full)\n",
            " (ignoring systematic absences):\n",
            " Unique reflections found (point group)       1401     981\n",
            " Unique reflections possible (point group)    1462     992\n",
            " Unique reflections found (Laue group)        1401     981\n",
            " Unique reflections possible (Laue group)     1462     992\n",
            "\n",
            " Special position constraints for Cu1\n",
            " x =  0.5000   y =  0.0000   z =  0.5000   sof = 0.50000   \n",
            " Input constraints retained (at least in part) for  sof\n",
            "\n",
            "\n",
            " Default effective X-H and X-D distances for T =   20.0C \n",
            " AFIX m =    1     2     3     4   4[N]  3[N]  15[B]  8[O]   9   9[N]   16\n",
            " d(X-H) =  0.98  0.97  0.96  0.93  0.86  0.89  1.10  0.82  0.93  0.86  0.93\n",
            "\n",
            " Note that these distances are chosen to give the best fit to the X-ray data\n",
            " and so avoid the introduction of systematic error.  The true internuclear\n",
            " distances are longer and do not vary with temperature!  The apparent\n",
            " variation with temperature is caused by libration.\n",
            "\n",
            "\n",
            " Least-squares cycle   1   Maximum vector length =  623   Memory required =     24 /   1359 /   120519\n",
            "\n",
            " wR2 =  0.0858 before cycle   1 for    1401 data and     72 /     72 parameters\n",
            "\n",
            " GooF = S =     1.107;     Restrained GooF =      1.107 for       0 restraints\n",
            "\n",
            " Weight = 1 / [ sigma^2(Fo^2) + ( 0.0354 * P )^2 +   0.27 * P ]   where  P = ( Max ( Fo^2, 0 ) + 2 * Fc^2 ) / 3\n",
            "\n",
            "\n",
            "     N      value        esd    shift/esd  parameter\n",
            "\n",
            "     1     8.16329     0.01870     0.001    OSF\n",
            "\n",
            " Mean shift/esd =   0.002  Maximum =    -0.018 for  U13 Cu1      \n",
            "\n",
            " Max. shift = 0.000 A for H5A        Max. dU = 0.000 for C3        \n",
            "\n",
            "\n",
            " Least-squares cycle   2   Maximum vector length =  623   Memory required =     24 /   1359 /   120519\n",
            "\n",
            " wR2 =  0.0858 before cycle   2 for    1401 data and     72 /     72 parameters\n",
            "\n",
            " GooF = S =     1.107;     Restrained GooF =      1.107 for       0 restraints\n",
            "\n",
            " Weight = 1 / [ sigma^2(Fo^2) + ( 0.0354 * P )^2 +   0.27 * P ]   where  P = ( Max ( Fo^2, 0 ) + 2 * Fc^2 ) / 3\n",
            "\n",
            "\n",
            "     N      value        esd    shift/esd  parameter\n",
            "\n",
            "     1     8.16326     0.01870    -0.001    OSF\n",
            "\n",
            " Mean shift/esd =   0.001  Maximum =    -0.006 for  U13 Cu1      \n",
            "\n",
            " Max. shift = 0.000 A for H5A        Max. dU = 0.000 for C3        \n",
            "\n",
            "\n",
            " Least-squares cycle   3   Maximum vector length =  623   Memory required =     24 /   1359 /   120519\n",
            "\n",
            " wR2 =  0.0858 before cycle   3 for    1401 data and     72 /     72 parameters\n",
            "\n",
            " GooF = S =     1.107;     Restrained GooF =      1.107 for       0 restraints\n",
            "\n",
            " Weight = 1 / [ sigma^2(Fo^2) + ( 0.0354 * P )^2 +   0.27 * P ]   where  P = ( Max ( Fo^2, 0 ) + 2 * Fc^2 ) / 3\n",
            "\n",
            "\n",
            "     N      value        esd    shift/esd  parameter\n",
            "\n",
            "     1     8.16326     0.01870     0.000    OSF\n",
            "\n",
            " Mean shift/esd =   0.000  Maximum =    -0.003 for tors H5A      \n",
            "\n",
            " Max. shift = 0.000 A for H5C        Max. dU = 0.000 for C2        \n",
            "\n",
            "\n",
            " Least-squares cycle   4   Maximum vector length =  623   Memory required =     24 /   1359 /   120519\n",
            "\n",
            " wR2 =  0.0858 before cycle   4 for    1401 data and     72 /     72 parameters\n",
            "\n",
            " GooF = S =     1.107;     Restrained GooF =      1.107 for       0 restraints\n",
            "\n",
            " Weight = 1 / [ sigma^2(Fo^2) + ( 0.0354 * P )^2 +   0.27 * P ]   where  P = ( Max ( Fo^2, 0 ) + 2 * Fc^2 ) / 3\n",
            "\n",
            "\n",
            "     N      value        esd    shift/esd  parameter\n",
            "\n",
            "     1     8.16326     0.01870     0.000    OSF\n",
            "\n",
            " Mean shift/esd =   0.000  Maximum =    -0.003 for tors H5A      \n",
            "\n",
            " Max. shift = 0.000 A for H5B        Max. dU = 0.000 for O2        \n",
            "\n",
            "\n",
            " Least-squares cycle   5   Maximum vector length =  623   Memory required =     24 /   1359 /   120519\n",
            "\n",
            " wR2 =  0.0858 before cycle   5 for    1401 data and     72 /     72 parameters\n",
            "\n",
            " GooF = S =     1.107;     Restrained GooF =      1.107 for       0 restraints\n",
            "\n",
            " Weight = 1 / [ sigma^2(Fo^2) + ( 0.0354 * P )^2 +   0.27 * P ]   where  P = ( Max ( Fo^2, 0 ) + 2 * Fc^2 ) / 3\n",
            "\n",
            "\n",
            "     N      value        esd    shift/esd  parameter\n",
            "\n",
            "     1     8.16326     0.01870     0.000    OSF\n",
            "\n",
            " Mean shift/esd =   0.000  Maximum =    -0.002 for tors H5A      \n",
            "\n",
            " Max. shift = 0.000 A for H5C        Max. dU = 0.000 for C2        \n",
            "\n",
            "\n",
            " Least-squares cycle   6   Maximum vector length =  623   Memory required =     24 /   1359 /   120519\n",
            "\n",
            " wR2 =  0.0858 before cycle   6 for    1401 data and     72 /     72 parameters\n",
            "\n",
            " GooF = S =     1.107;     Restrained GooF =      1.107 for       0 restraints\n",
            "\n",
            " Weight = 1 / [ sigma^2(Fo^2) + ( 0.0354 * P )^2 +   0.27 * P ]   where  P = ( Max ( Fo^2, 0 ) + 2 * Fc^2 ) / 3\n",
            "\n",
            "\n",
            "     N      value        esd    shift/esd  parameter\n",
            "\n",
            "     1     8.16326     0.01870     0.000    OSF\n",
            "\n",
            " Mean shift/esd =   0.000  Maximum =    -0.002 for tors H5A      \n",
            "\n",
            " Max. shift = 0.000 A for H5A        Max. dU = 0.000 for O2        \n",
            "\n",
            "\n",
            " Least-squares cycle   7   Maximum vector length =  623   Memory required =     24 /   1359 /   120519\n",
            "\n",
            " wR2 =  0.0858 before cycle   7 for    1401 data and     72 /     72 parameters\n",
            "\n",
            " GooF = S =     1.107;     Restrained GooF =      1.107 for       0 restraints\n",
            "\n",
            " Weight = 1 / [ sigma^2(Fo^2) + ( 0.0354 * P )^2 +   0.27 * P ]   where  P = ( Max ( Fo^2, 0 ) + 2 * Fc^2 ) / 3\n",
            "\n",
            "\n",
            "     N      value        esd    shift/esd  parameter\n",
            "\n",
            "     1     8.16325     0.01870     0.000    OSF\n",
            "\n",
            " Mean shift/esd =   0.000  Maximum =    -0.002 for tors H5A      \n",
            "\n",
            " Max. shift = 0.000 A for H5A        Max. dU = 0.000 for C2        \n",
            "\n",
            "\n",
            " Least-squares cycle   8   Maximum vector length =  623   Memory required =     24 /   1359 /   120519\n",
            "\n",
            " wR2 =  0.0858 before cycle   8 for    1401 data and     72 /     72 parameters\n",
            "\n",
            " GooF = S =     1.107;     Restrained GooF =      1.107 for       0 restraints\n",
            "\n",
            " Weight = 1 / [ sigma^2(Fo^2) + ( 0.0354 * P )^2 +   0.27 * P ]   where  P = ( Max ( Fo^2, 0 ) + 2 * Fc^2 ) / 3\n",
            "\n",
            "\n",
            "     N      value        esd    shift/esd  parameter\n",
            "\n",
            "     1     8.16325     0.01870     0.000    OSF\n",
            "\n",
            " Mean shift/esd =   0.000  Maximum =    -0.002 for tors H5A      \n",
            "\n",
            " Max. shift = 0.000 A for H5A        Max. dU = 0.000 for C2        \n",
            "\n",
            "\n",
            " Least-squares cycle   9   Maximum vector length =  623   Memory required =     24 /   1359 /   120519\n",
            "\n",
            " wR2 =  0.0858 before cycle   9 for    1401 data and     72 /     72 parameters\n",
            "\n",
            " GooF = S =     1.107;     Restrained GooF =      1.107 for       0 restraints\n",
            "\n",
            " Weight = 1 / [ sigma^2(Fo^2) + ( 0.0354 * P )^2 +   0.27 * P ]   where  P = ( Max ( Fo^2, 0 ) + 2 * Fc^2 ) / 3\n",
            "\n",
            "\n",
            "     N      value        esd    shift/esd  parameter\n",
            "\n",
            "     1     8.16325     0.01870     0.000    OSF\n",
            "\n",
            " Mean shift/esd =   0.000  Maximum =    -0.002 for tors H5A      \n",
            "\n",
            " Max. shift = 0.000 A for H5C        Max. dU = 0.000 for C2        \n",
            "\n",
            "\n",
            " Least-squares cycle  10   Maximum vector length =  623   Memory required =     24 /   1359 /   120519\n",
            "\n",
            " wR2 =  0.0858 before cycle  10 for    1401 data and     72 /     72 parameters\n",
            "\n",
            " GooF = S =     1.107;     Restrained GooF =      1.107 for       0 restraints\n",
            "\n",
            " Weight = 1 / [ sigma^2(Fo^2) + ( 0.0354 * P )^2 +   0.27 * P ]   where  P = ( Max ( Fo^2, 0 ) + 2 * Fc^2 ) / 3\n",
            "\n",
            "\n",
            "     N      value        esd    shift/esd  parameter\n",
            "\n",
            "     1     8.16325     0.01870     0.000    OSF\n",
            "\n",
            " Mean shift/esd =   0.000  Maximum =    -0.002 for tors H5A      \n",
            "\n",
            " Max. shift = 0.000 A for H5C        Max. dU = 0.000 for O2        \n",
            "\n",
            "\n",
            " Largest correlation matrix elements\n",
            "\n",
            "     0.561 U11 Cu1 / OSF                     0.532 U33 Cu1 / OSF                     0.528 U22 Cu1 / OSF \n",
            "\n",
            "\n",
            "\n",
            " Idealized hydrogen atom generation before cycle  11\n",
            "\n",
            " Name     x       y       z    AFIX  d(X-H)  shift  Bonded to  Conformation determined by\n",
            " H1A   0.8770  0.4225  0.5215  137   0.960   0.000   C1            C2  H1A  \n",
            " H1B   0.8528  0.6323  0.6266  137   0.960   0.000   C1            C2  H1A  \n",
            " H1C   0.8047  0.7134  0.4977  137   0.960   0.000   C1            C2  H1A  \n",
            " H3    0.6382  0.6851  0.7019   43   0.930   0.000   C3            C4  C2  \n",
            " H5A   0.3748  0.7207  0.7557  137   0.960   0.000   C5            C4  H5A  \n",
            " H5B   0.4714  0.5831  0.8501  137   0.960   0.000   C5            C4  H5A  \n",
            " H5C   0.3461  0.4162  0.8067  137   0.960   0.000   C5            C4  H5A  \n",
            "\n",
            "\n",
            "\n",
            "  jkc18jc03bVT_11_200_00 in P2(1)/n                                          \n",
            "\n",
            " ATOM           x        y        z         sof        U11      U22      U33      U23      U13      U12       Ueq\n",
            "\n",
            " Cu1         0.50000  0.00000  0.50000    0.50000    0.02010  0.01932  0.02403 -0.00402  0.00608 -0.00255   0.02102\n",
            "   0.00000   0.00000  0.00000  0.00000    0.00000    0.00020  0.00022  0.00022  0.00015  0.00014  0.00014   0.00014\n",
            "\n",
            " C1          0.81749  0.55890  0.55285    1.00000    0.02154  0.03047  0.03396 -0.00356  0.00322 -0.00483   0.02860\n",
            "   0.00431   0.00022  0.00054  0.00024    0.00000    0.00102  0.00125  0.00128  0.00106  0.00093  0.00093   0.00052\n",
            "\n",
            " H1A         0.87696  0.42252  0.52152    1.00000    0.04290\n",
            "                                          0.00000    0.00000\n",
            "\n",
            " H1B         0.85278  0.63230  0.62659    1.00000    0.04290\n",
            "                                          0.00000    0.00000\n",
            "\n",
            " H1C         0.80467  0.71344  0.49771    1.00000    0.04290\n",
            "                                          0.00000    0.00000\n",
            "\n",
            " O1          0.66206  0.20365  0.50634    1.00000    0.02197  0.02175  0.02953 -0.00402  0.00694 -0.00237   0.02426\n",
            "   0.00268   0.00014  0.00032  0.00014    0.00000    0.00073  0.00078  0.00084  0.00069  0.00062  0.00063   0.00035\n",
            "\n",
            " O2          0.43475  0.19770  0.63436    1.00000    0.02457  0.02205  0.02654 -0.00314  0.00825 -0.00334   0.02420\n",
            "   0.00270   0.00014  0.00033  0.00013    0.00000    0.00075  0.00078  0.00082  0.00068  0.00063  0.00063   0.00035\n",
            "\n",
            " C2          0.68932  0.41569  0.57275    1.00000    0.01997  0.01902  0.02322  0.00298 -0.00100 -0.00015   0.02078\n",
            "   0.00393   0.00020  0.00049  0.00019    0.00000    0.00095  0.00097  0.00106  0.00090  0.00081  0.00082   0.00043\n",
            "\n",
            " C4          0.48837  0.41068  0.68593    1.00000    0.02563  0.01988  0.01907  0.00076  0.00098  0.00229   0.02152\n",
            "   0.00396   0.00021  0.00050  0.00019    0.00000    0.00102  0.00100  0.00102  0.00089  0.00083  0.00088   0.00044\n",
            "\n",
            " C3          0.60913  0.52564  0.65943    1.00000    0.02586  0.02437  0.02275 -0.00455  0.00112 -0.00468   0.02432\n",
            "   0.00404   0.00022  0.00047  0.00021    0.00000    0.00107  0.00117  0.00109  0.00092  0.00087  0.00088   0.00048\n",
            "\n",
            " H3          0.63825  0.68513  0.70190    1.00000    0.02918\n",
            "                                          0.00000    0.00000\n",
            "\n",
            " C5          0.41339  0.54485  0.78342    1.00000    0.03168  0.03377  0.02897 -0.00915  0.00980 -0.00274   0.03125\n",
            "   0.00451   0.00024  0.00054  0.00022    0.00000    0.00123  0.00136  0.00126  0.00106  0.00102  0.00102   0.00056\n",
            "\n",
            " H5A         0.37483  0.72071  0.75566    1.00000    0.04688\n",
            "                                          0.00000    0.00000\n",
            "\n",
            " H5B         0.47139  0.58314  0.85010    1.00000    0.04688\n",
            "                                          0.00000    0.00000\n",
            "\n",
            " H5C         0.34613  0.41624  0.80666    1.00000    0.04688\n",
            "                                          0.00000    0.00000\n",
            "\n",
            "\n",
            "\n",
            " Final Structure Factor Calculation for  jkc18jc03bVT_11_200_00 in P2(1)/n                                          \n",
            "\n",
            " Total number of l.s. parameters =    72  Maximum vector length =  623   Memory required =     24 /   1287 /    28035\n",
            "\n",
            " wR2 =  0.0858 before cycle  11 for    1401 data and      0 /     72 parameters\n",
            "\n",
            " GooF = S =     1.107;     Restrained GooF =      1.107 for       0 restraints\n",
            "\n",
            " Weight = 1 / [ sigma^2(Fo^2) + ( 0.0354 * P )^2 +   0.27 * P ]   where  P = ( Max ( Fo^2, 0 ) + 2 * Fc^2 ) / 3\n",
            "\n",
            " wR2 = 0.0858, GooF = S = 1.107, Restrained GooF = 1.107 for all data\n",
            " R1 = 0.0324 for 1197 Fo > 4sig(Fo) and 0.0401 for all 1401 data\n",
            "\n",
            " Occupancy sum of asymmetric unit =     7.50 for non-hydrogen and     7.00 for H and D atoms\n",
            "\n",
            "\n",
            "\n",
            " Principal mean square atomic displacements U\n",
            "\n",
            "   0.0296   0.0172   0.0162   Cu1  \n",
            "   0.0373   0.0291   0.0194   C1  \n",
            "   0.0343   0.0201   0.0185   O1  \n",
            "   0.0343   0.0205   0.0179   O2  \n",
            "   0.0254   0.0197   0.0173   C2  \n",
            "   0.0264   0.0197   0.0184   C4  \n",
            "   0.0310   0.0241   0.0178   C3  \n",
            "   0.0449   0.0299   0.0189   C5  \n",
            "\n",
            "     0  atoms may be split and     0  atoms NPD\n",
            "\n",
            "\n",
            "\n",
            " Analysis of variance for reflections employed in refinement      K = Mean[Fo^2] / Mean[Fc^2]  for group\n",
            "\n",
            "\n",
            " Fc/Fc(max)       0.000    0.013    0.026    0.044    0.064    0.085    0.107    0.132    0.169    0.235    1.000\n",
            "\n",
            " Number in group       149.     134.     141.     136.     142.     143.     137.     138.     140.     141.\n",
            "\n",
            "            GooF      1.078    1.122    1.184    1.432    0.994    0.860    0.966    1.036    1.101    1.212\n",
            "\n",
            "             K        2.704    1.040    1.064    1.045    1.020    1.012    1.002    0.994    1.000    1.002\n",
            "\n",
            "\n",
            " Resolution(A)    0.73     0.76     0.79     0.83     0.87     0.92     1.00     1.10     1.25     1.55     inf\n",
            "\n",
            " Number in group       144.     137.     139.     143.     138.     140.     139.     143.     137.     141.\n",
            "\n",
            "            GooF      0.770    0.953    0.870    0.863    0.864    0.834    0.967    0.888    1.387    2.044\n",
            "\n",
            "             K        1.013    1.017    1.003    1.002    1.000    1.011    1.005    0.998    0.995    1.007\n",
            "\n",
            "             R1       0.083    0.069    0.066    0.046    0.045    0.033    0.033    0.024    0.031    0.030\n",
            "\n",
            "\n",
            " Recommended weighting scheme:  WGHT    0.0354    0.2719\n",
            "\n",
            "\n",
            " Most Disagreeable Reflections (* if suppressed or used for Rfree).\n",
            " Error/esd is calculated as sqrt(wD^2/<wD^2>) where w is given by the weight\n",
            " formula, D = Fo^2-Fc^2 and <> refers to the average over all reflections.\n",
            "\n",
            "     h   k   l          Fo^2          Fc^2    Error/esd  Fc/Fc(max)  Resolution(A)\n",
            "\n",
            "     1   2   2         85.60         40.46       7.42       0.051       2.11\n",
            "     0   1   4         48.56         28.55       4.98       0.043       2.42\n",
            "     1   2   3        231.04        321.43       4.82       0.145       1.94\n",
            "    -3   1   2        342.65        437.24       4.76       0.169       2.51\n",
            "     3   1   4         27.47         49.59       4.39       0.057       1.94\n",
            "    -2   0   4         16.81         31.51       4.39       0.045       2.52\n",
            "    -5   0   1        166.53        218.85       4.18       0.120       2.03\n",
            "     0   3   1        118.65        157.68       3.89       0.102       1.54\n",
            "     3   1   6        338.73        435.07       3.43       0.169       1.53\n",
            "     2   0   2        108.23         81.29       3.41       0.073       3.73\n",
            "     1   3   5         69.35         47.29       3.27       0.056       1.27\n",
            "     2   3   2         28.28         10.92       3.26       0.027       1.44\n",
            "     1   1   3       2354.26       2067.80       3.22       0.368       2.80\n",
            "     0   2   3          2.97          7.80       3.13       0.023       1.99\n",
            "     2   2   1         15.28          7.70       3.10       0.022       2.08\n",
            "     0   2   5         15.88         27.21       3.08       0.042       1.62\n",
            "     6   3  10         60.07        101.92       3.01       0.082       0.80\n",
            "     2   1   2       2376.70       2104.03       2.99       0.371       2.92\n",
            "     0   2   2        425.90        497.48       2.97       0.181       2.16\n",
            "     2   1   4        328.42        275.42       2.95       0.134       2.16\n",
            "     2   0   4       1125.22       1290.40       2.83       0.291       2.44\n",
            "     6   4   3         15.91          0.07       2.66       0.002       0.93\n",
            "    -2   2   3         10.13          5.06       2.61       0.018       1.86\n",
            "     3   1   5         83.43         62.36       2.61       0.064       1.72\n",
            "     4   1   2        296.69        256.91       2.60       0.130       2.07\n",
            "    -5   3   5          0.82          4.98       2.56       0.018       1.10\n",
            "    -3   3   1          5.06          1.57       2.53       0.010       1.41\n",
            "    -3   0   5        840.76        953.05       2.53       0.250       1.92\n",
            "     1   1   1       1081.95        974.64       2.47       0.253       3.96\n",
            "    -3   0   1         61.23         77.56       2.46       0.071       3.31\n",
            "    11   1   5         38.37         21.10       2.45       0.037       0.84\n",
            "     0   2   6        392.39        448.31       2.44       0.171       1.47\n",
            "     5   0   3       2724.25       3021.94       2.39       0.445       1.77\n",
            "     5   2   8         90.34        125.36       2.38       0.091       1.03\n",
            "     4   1   5        251.64        294.12       2.37       0.139       1.57\n",
            "    10   1   0         36.88         25.62       2.37       0.041       1.00\n",
            "    -4   1   2        862.06        772.18       2.35       0.225       2.11\n",
            "     4   0   2       2391.17       2645.43       2.34       0.416       2.30\n",
            "     5   3   9          3.83         12.84       2.32       0.029       0.87\n",
            "     0   4  11          1.49          9.88       2.32       0.025       0.77\n",
            "    -2   0   8        745.84        664.05       2.31       0.209       1.38\n",
            "     6   1   2          7.00          2.66       2.30       0.013       1.53\n",
            "     2   1   5         25.38         39.99       2.29       0.051       1.87\n",
            "     4   1   0       2179.81       1990.48       2.27       0.361       2.25\n",
            "     2   0   8        990.38       1119.33       2.26       0.271       1.35\n",
            "     3   2   5       4106.73       3728.14       2.26       0.494       1.45\n",
            "     0   5   2          6.93          1.96       2.25       0.011       0.92\n",
            "     6   1   5        681.12        857.96       2.23       0.237       1.29\n",
            "     1   2   0         12.04         17.94       2.22       0.034       2.28\n",
            "     2   2   3        122.36        103.54       2.22       0.082       1.84\n",
            "\n",
            "\n",
            "\n",
            " Bond lengths and angles\n",
            "\n",
            " Cu1 -           Distance        Angles\n",
            " O1        1.9166 (0.0015) \n",
            " O1_$1     1.9166 (0.0015)  180.00       \n",
            " O2        1.9209 (0.0014)   93.46 (0.06)  86.54 (0.06)\n",
            " O2_$1     1.9209 (0.0014)   86.54 (0.06)  93.46 (0.06) 180.00       \n",
            "                 Cu1             O1            O1_$1         O2           \n",
            "\n",
            " C1 -            Distance        Angles\n",
            " C2        1.5016 (0.0029) \n",
            "                 C1             \n",
            "\n",
            " O1 -            Distance        Angles\n",
            " C2        1.2684 (0.0027) \n",
            " Cu1       1.9166 (0.0014)  125.59 (0.13)\n",
            "                 O1              C2           \n",
            "\n",
            " O2 -            Distance        Angles\n",
            " C4        1.2688 (0.0027) \n",
            " Cu1       1.9209 (0.0014)  125.63 (0.13)\n",
            "                 O2              C4           \n",
            "\n",
            " C2 -            Distance        Angles\n",
            " O1        1.2684 (0.0027) \n",
            " C3        1.4019 (0.0030)  125.32 (0.20)\n",
            " C1        1.5016 (0.0029)  115.76 (0.19) 118.91 (0.21)\n",
            "                 C2              O1            C3           \n",
            "\n",
            " C4 -            Distance        Angles\n",
            " O2        1.2688 (0.0027) \n",
            " C3        1.3949 (0.0030)  125.27 (0.20)\n",
            " C5        1.5056 (0.0029)  115.98 (0.19) 118.74 (0.21)\n",
            "                 C4              O2            C3           \n",
            "\n",
            " C3 -            Distance        Angles\n",
            " C4        1.3949 (0.0030) \n",
            " C2        1.4019 (0.0030)  124.07 (0.21)\n",
            "                 C3              C4           \n",
            "\n",
            " C5 -            Distance        Angles\n",
            " C4        1.5056 (0.0029) \n",
            "                 C5             \n",
            "\n",
            "\n",
            "\n",
            " Selected torsion angles\n",
            "\n",
            "     4.90 ( 0.32)  Cu1 - O1 - C2 - C3\n",
            "  -173.84 ( 0.15)  Cu1 - O1 - C2 - C1\n",
            "    -4.97 ( 0.33)  Cu1 - O2 - C4 - C3\n",
            "   175.23 ( 0.16)  Cu1 - O2 - C4 - C5\n",
            "    -1.37 ( 0.38)  O2 - C4 - C3 - C2\n",
            "   178.43 ( 0.22)  C5 - C4 - C3 - C2\n",
            "     1.41 ( 0.38)  O1 - C2 - C3 - C4\n",
            "  -179.88 ( 0.22)  C1 - C2 - C3 - C4\n",
            "\n",
            "\n",
            "\n",
            " Least-squares planes (x,y,z in crystal coordinates) and deviations from them\n",
            " (* indicates atom used to define plane)\n",
            "\n",
            "  4.1289 (0.0066) x -  3.0053 (0.0022) y +  7.1941 (0.0059) z =  5.7173 (0.0037) \n",
            "\n",
            " * -0.0558 (0.0008)  Cu1\n",
            " *  0.0469 (0.0012)  O1\n",
            " *  0.0473 (0.0012)  O2\n",
            " *  0.0000 (0.0015)  C2\n",
            " * -0.0380 (0.0016)  C3\n",
            " * -0.0004 (0.0015)  C4\n",
            "\n",
            " Rms deviation of fitted atoms =   0.0387\n",
            "\n",
            "\n",
            "\n",
            " FMAP and GRID set by program\n",
            "\n",
            " FMAP   2   2   9\n",
            " GRID    -4.167  -2  -2     4.167   2   2\n",
            "\n",
            " R1 =  0.0397 for   1401 unique reflections after merging for Fourier\n",
            "\n",
            "\n",
            " Electron density synthesis with coefficients Fo-Fc\n",
            "\n",
            " Highest peak    0.35  at  0.6018  0.1590  0.5236  [  0.69 A from O1 ]\n",
            " Deepest hole   -0.31  at  0.1291  0.2417  0.7492  [  0.12 A from H5A ]\n",
            "\n",
            "\n",
            " Fourier peaks appended to .res file\n",
            "\n",
            "              x       y       z       sof     U      Peak   Distances to nearest atoms (including eq.)\n",
            "\n",
            " Q1    1   0.6018  0.1590  0.5236   1.00000  0.05    0.35   0.69 O1  1.30 CU1  1.59 C2  2.17 O2\n",
            " Q2    1   0.8064  0.7554  0.5625   1.00000  0.05    0.31   0.76 H1C  0.93 C1  1.03 H1B  1.78 H1A\n",
            " Q3    1   0.4420  0.3141  0.6242   1.00000  0.05    0.31   0.56 O2  0.94 C4  2.01 C3  2.13 C5\n",
            " Q4    1   0.7538  0.4921  0.5595   1.00000  0.05    0.31   0.73 C1  0.77 C2  1.36 H1C  1.39 H1A\n",
            " Q5    1   0.6850  0.2522  0.5523   1.00000  0.05    0.30   0.61 O1  0.80 C2  1.94 C3  1.98 C1\n",
            " Q6    1   0.4416  0.7478  0.8056   1.00000  0.05    0.29   0.88 H5A  0.96 H5B  1.02 C5  1.83 H5C\n",
            " Q7    1   0.6551  0.3234  0.5170   1.00000  0.05    0.28   0.58 O1  0.83 C2  1.94 C3  2.03 C1\n",
            " Q8    1   0.4822  0.2669  0.6768   1.00000  0.05    0.28   0.68 C4  0.74 O2  1.79 C3  1.93 C5\n",
            " Q9    1   0.4222  0.4020  0.8515   1.00000  0.05    0.28   0.92 H5C  0.99 H5B  1.02 C5  1.89 H5A\n",
            " Q10   1   0.5379  0.4827  0.6620   1.00000  0.05    0.28   0.68 C4  0.76 C3  1.46 H3  1.72 O2\n",
            " Q11   1   0.8287  0.5644  0.4838   1.00000  0.05    0.25   0.76 H1C  0.79 C1  0.92 H1A  1.65 H1B\n",
            " Q12   1   0.4582  0.1044  0.4390   1.00000  0.05    0.25   0.94 CU1  1.99 O2  2.01 O1  2.09 H3\n",
            " Q13   1   0.4614  0.4555  0.7372   1.00000  0.05    0.24   0.68 C4  0.84 C5  1.41 H5B  1.46 H5C\n",
            " Q14   1   0.4278  0.0870  0.5851   1.00000  0.05    0.24   0.76 O2  1.30 CU1  1.92 O1  1.98 C4\n",
            " Q15   1   0.3228  0.5571  0.7621   1.00000  0.05    0.23   0.86 H5C  0.94 H5A  0.95 C5  1.79 H5B\n",
            " Q16   1   0.6329  0.4717  0.5608   1.00000  0.05    0.22   0.65 C2  1.18 C3  1.43 O1  1.88 H3\n",
            " Q17   1   0.4760  0.1695  0.6001   1.00000  0.05    0.22   0.60 O2  1.41 CU1  1.49 C4  2.23 O1\n",
            " Q18   1   0.5857  0.5516  0.5985   1.00000  0.05    0.21   0.73 C3  1.28 C2  1.41 H3  1.58 C4\n",
            " Q19   1   0.6029  0.4949  0.5806   1.00000  0.05    0.21   0.90 C3  0.97 C2  1.66 H3  1.72 O1\n",
            " Q20   1   0.7047  0.1603  0.4860   1.00000  0.05    0.21   0.54 O1  1.56 C2  2.18 H1A  2.24 CU1\n",
            "\n",
            " Shortest distances between peaks (including symmetry equivalents)\n",
            "\n",
            "     18  19  0.38     16  19  0.40      5   7  0.60     14  17  0.64      3   8  0.74     16  18  0.76      3  17  0.81\n",
            "      7  16  0.89      5  20  0.89     10  18  0.94      1   7  0.95      8  17  0.98      7  20  0.99      1   5  1.00\n",
            "      8  13  1.14      1  20  1.15      3  14  1.16     10  19  1.16      5  16  1.16      8  10  1.17     10  13  1.19\n",
            "      7  19  1.21      4  11  1.22      4  16  1.25      2  11  1.29      3  10  1.32      4   5  1.33      2   4  1.34\n",
            "      4   7  1.36      9  13  1.39      8  14  1.43      3  13  1.45      1  12  1.45      5  19  1.46     12  14  1.51\n",
            "     12  17  1.52     10  16  1.53     13  15  1.54      1  16  1.55      6  15  1.57      4  19  1.58      1  17  1.58\n",
            "      9  15  1.58      6  13  1.59      7  18  1.59     12  14  1.69      1  19  1.70      1  14  1.70      6   9  1.71\n",
            "     12  18  1.72     10  17  1.73      1  12  1.75      4  18  1.82      5  18  1.82      4  20  1.82     12  17  1.85\n",
            "     16  20  1.85     12  12  1.87      3  18  1.88      3  19  1.94     14  20  1.94      8  18  1.94      1  14  1.97\n",
            "     12  19  1.99      8  19  1.99     17  19  2.02      1  18  2.03     13  17  2.06     13  18  2.11     17  18  2.11\n",
            "      7  11  2.15      1   3  2.16     19  20  2.18      8   9  2.19     12  16  2.19      7  10  2.20     16  17  2.20\n",
            "      1  17  2.21      7  17  2.22      1   8  2.22      2  16  2.22      5  12  2.23      1   4  2.23      5  11  2.24\n",
            "      3  16  2.24     10  12  2.24      5  10  2.26     11  16  2.26      5  17  2.27     12  20  2.27      8  12  2.27\n",
            "      8  16  2.28     11  20  2.28      1  10  2.29      6  10  2.30      2  20  2.31      3  15  2.32     10  14  2.32\n",
            "      3  12  2.32      3  12  2.33     13  19  2.34      8  15  2.36      7  12  2.38      7  14  2.38      7  12  2.40\n",
            "      3  16  2.42      2  19  2.43     13  14  2.45      5  14  2.48      2  18  2.51      3   7  2.51      3  19  2.51\n",
            "      9  10  2.52      6  11  2.52      4  10  2.54      3   7  2.54     10  15  2.55      5   8  2.56     18  20  2.56\n",
            "     17  20  2.58     12  20  2.58      2   7  2.59      7   8  2.59      3  18  2.60      1   1  2.60     14  14  2.60\n",
            "      3   9  2.62     11  19  2.62     14  19  2.62      2   5  2.64     14  17  2.64     17  18  2.65      3   5  2.67\n",
            "     14  18  2.68     17  19  2.68     16  17  2.69      1  18  2.69     14  16  2.70      5  12  2.71     14  18  2.71\n",
            "     13  16  2.71     14  19  2.72      6   8  2.72      7  14  2.72     17  20  2.72     19  19  2.74     18  19  2.76\n",
            "      9  20  2.77     15  15  2.78      5  14  2.79     14  16  2.79      2  12  2.80      8  12  2.80      1   3  2.80\n",
            "     12  16  2.81      7  18  2.81     12  19  2.81     17  17  2.82     16  18  2.83     18  18  2.83      9  11  2.83\n",
            "      1   2  2.85     16  19  2.86     11  18  2.86      1  19  2.87      4  12  2.88      3   6  2.88      7  10  2.92\n",
            "      3  20  2.93      6  14  2.95      7  17  2.96      7  19  2.96      6  18  2.96      2  14  2.97      3   4  2.98\n",
            "      2   9  3.00\n",
            "\n",
            "\n",
            " Time profile in seconds\n",
            " -----------------------\n",
            "\n",
            "      0.00: Read and process instructions\n",
            "      0.00: Fit rigid groups\n",
            "      0.00: Interpret restraints etc.\n",
            "      0.00: Generate connectivity array\n",
            "      0.00: Analyse DFIX and DANG restraints\n",
            "      0.00: Analyse SAME, SADI and NCSY restraints\n",
            "      0.00: Generate CHIV restraints\n",
            "      0.00: Check if bonds in residues restrained\n",
            "      0.00: Generate DELU and RIGU restraints\n",
            "      0.00: Generate SIMU restraints\n",
            "      0.00: Generate ISOR restraints\n",
            "      0.00: Analyse electron density\n",
            "      0.00: Analyse other restraints etc.\n",
            "      0.02: Read intensity data, sort/merge etc.\n",
            "      0.00: Set up constraints\n",
            "      0.00: OSF, H-atoms from difference map\n",
            "      0.01: Set up l.s. refinement\n",
            "      0.00: Generate idealized H-atoms\n",
            "      0.00: Structure factors and derivatives\n",
            "      0.00: Sum l.s. matrices\n",
            "      0.00: Generate and apply antibumping restraints\n",
            "      0.00: Apply other restraints\n",
            "      0.07: Solve l.s. equations\n",
            "      0.00: Generate HTAB table\n",
            "      0.01: Other dependent quantities, CIF, tables\n",
            "      0.00: Analysis of variance\n",
            "      0.00: Merge reflections for Fourier and .fcf\n",
            "      0.00: Fourier summations\n",
            "      0.00: Peaksearch\n",
            "      0.00: Analyse peaklist\n",
            "\n",
            " ** WARNING: These times are only approximate for multiple threads.\n",
            "             To get better estimates run with -t1 **\n",
            "\n",
            '   Please cite: G.M. Sheldrick (2015) "Crystal structure refinement with\n',
            '   SHELXL", Acta Cryst., C71, 3-8 (Open Access) if SHELXL proves useful.\n',
            "\n",
            " +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n",
            " +  200           finished at 10:59:49   Total elapsed time:      0.12 secs  +\n",
            " +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n",
        ]

    def test_angle_calculation(self):
        """
        Makes sure the angle between MPLA and a defined crystallographic plane is correct
        """

        ref_plane = [1, 0, 0]
        ref_values = [10.272757, 4.673770, 11.309690, 90, 92.1849, 90]

        output_angle = self.test.calculate_planes(
            self.sample_lst_file, ref_plane, ref_values
        )

        self.assertEqual(round(output_angle, 2), 64.75)
